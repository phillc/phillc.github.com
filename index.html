
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>phillc - Phillip Campbell</title>
	<meta name="author" content="Phillip Campbell">

	
	<meta name="description" content="tech Page Specific JavaScript With the Rails Asset Pipeline I&rsquo;ve been using a pattern for loading javascript for specific pages that I would &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="" rel="alternate" title="phillc - Phillip Campbell" type="application/atom+xml">
	
	<link rel="canonical" href="http://phillc.com/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4379922-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><a href="/" class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/a378a027352ae0dc9c0bd249d06b46c3?s=160" alt="Profile Picture" style="width: 160px;" />
	
</a>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Home</a></li>
    <li><a href="/blog/archives">Archives</a></li>
    <li style="color: #666;">Side projects:</li>
    <li><a href="http://agentvsagent.com">Agent vs Agent</a></li>
    <li><a href="http://rosterbater.com">Rosterbater</a></li>
    <li><a href="http://www.cheapboardgamer.com">the Cheap Boardgamer</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
			<a class="facebook" href="http://www.facebook.com/phillc" title="Facebook">Facebook</a>
		
		
		
			<a class="twitter" href="http://twitter.com/phillc" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/phillc" title="GitHub">GitHub</a>
		
		
		
		
			<a class="linkedin" href="http://www.linkedin.com/in/phillc1" title="LinkedIn">LinkedIn</a>
		
		
		
		
		
		
		
    	
    	
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-07-21T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tech/'>tech</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/07/21/page-specific-javascript-with-the-rails-asset-pipeline/" itemprop="url">Page Specific JavaScript With the Rails Asset Pipeline</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I&rsquo;ve been using a pattern for loading javascript for specific pages that I would like to share. I have been using it for the past three years across many projects, and has proven to be durable.</p>

<p>It was created in response to three patterns that I saw and disliked.</p>

<ul>
<li>Using <code>javascript_include_tag</code> to bring in page specific javascript</li>
<li>Keying javascript off of a html element id <code>if ($("#some_div")) { ... }</code></li>
<li>Inline javascript</li>
</ul>


<p>I found all these solutions to be inadequate because they required extra web requests, didn&rsquo;t take advantage of js compression, had javascript overhead of checking the page for contents, didn&rsquo;t allow the use of coffeescript, or left javascript scattered around the project. The Rails Asset Pipeline solves all those problems.</p>

<p>My solution is to use a JavaScript object to wrap pages, which I will call Page Objects.</p>

<p>A Page Object looks like this:</p>

<figure class='code'><figcaption><span>app/assets/javascripts/app/pages/home_page.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nv">APP.HomePage = </span><span class="k">class</span> <span class="nx">HomePage</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">(options) -&gt;</span>
</span><span class='line'>    <span class="vi">@data = </span><span class="nx">options</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">bind: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">@bindThing</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">@bindOtherthing</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">bindThing: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">otherSomething</span><span class="p">(</span><span class="nx">@data</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">bindOtherthing: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">otherSomething</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Every Page Object is applied to window.APP, has a <code>bind</code> method which will run any page specific code, and lives in app/assets/javascripts/app/pages. You will see why in a moment. The constructor is optional.</p>

<p>We bring this into our asset pipeline like so:</p>

<figure class='code'><figcaption><span>app/assets/javascripts/application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="o">//=</span> <span class="nx">require</span> <span class="p">.</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">init</span>
</span><span class='line'><span class="o">//=</span> <span class="nx">require_tree</span> <span class="p">.</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">objects</span>
</span><span class='line'><span class="o">//=</span> <span class="nx">require_tree</span> <span class="p">.</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">pages</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our pages are assigned to <code>window.APP</code>, which needs to be initialized before the page objects are loaded. Because requiring javascript files must happen at the top of your file, before any executable javascript is written, we must move the initialization of <code>window.APP</code> to another file.</p>

<figure class='code'><figcaption><span>app/assets/javascripts/app/init.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nv">APP = </span><span class="p">{}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we want to have rails instantiate one of these objects, and call our <code>bind</code> method for us.</p>

<figure class='code'><figcaption><span>app/helpers/application_helper.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">ApplicationHelper</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">load_javascript_class</span><span class="p">(</span><span class="n">javascript_class</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="n">content_for</span> <span class="ss">:page_javascript</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">javascript_tag</span> <span class="s2">&quot;$(function(){ (new window.APP.</span><span class="si">#{</span><span class="n">javascript_class</span><span class="si">}</span><span class="s2">(</span><span class="si">#{</span><span class="n">options</span><span class="o">.</span><span class="n">to_json</span><span class="si">}</span><span class="s2">)).bind(); })&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/views/layouts/application.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="nn">!!!5</span>
</span><span class='line'><span class="nt">%html</span><span class="p">{</span><span class="ss">lang</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nt">%body</span>
</span><span class='line'>    <span class="p">=</span> <span class="n">render</span> <span class="s1">&#39;layouts/header&#39;</span>
</span><span class='line'>    <span class="p">=</span> <span class="k">yield</span>
</span><span class='line'>    <span class="p">=</span> <span class="n">render</span> <span class="s1">&#39;layouts/footer&#39;</span>
</span><span class='line'>    <span class="p">=</span> <span class="k">yield</span> <span class="ss">:page_javascript</span>
</span></code></pre></td></tr></table></div></figure>


<p>The last part of it is to call it from your view</p>

<figure class='code'><figcaption><span>app/views/home/index.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="p">-</span> <span class="n">load_javascript_class</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span> <span class="ss">data</span><span class="p">:</span> <span class="o">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.container</span>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nt">%h3</span> List:
</span></code></pre></td></tr></table></div></figure>


<p>With this pattern, you can have page specific javascript while utilizing the asset pipeline of rails. This solution also solves the problem of how to get data from rails to your javascript. You can see in the helper that if you pass in a second argument to <code>load_javascript_class</code> that it will take it, and turn it into json for your page object&rsquo;s constructor.</p>

<p>You may have noticed that I also have a app/objects required in the application.js. I do this to create objects that may be shared between pages. I tend to use a similar pattern as page objects, and instantiate/delegate to them from a page object.</p>

<p>Some sites need to have two sets of javascript, perhaps for very different sections of the site, like an admin area. You can change the helper to be</p>

<figure class='code'><figcaption><span>app/helpers/application_helper.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">load_javascript_class</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">javascript_class</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>  <span class="n">content_for</span> <span class="ss">:page_javascript</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">javascript_tag</span> <span class="s2">&quot;$(function(){ (new window.</span><span class="si">#{</span><span class="n">namespace</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">upcase</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">javascript_class</span><span class="si">}</span><span class="s2">(</span><span class="si">#{</span><span class="n">options</span><span class="o">.</span><span class="n">to_json</span><span class="si">}</span><span class="s2">)).bind(); })&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first parameter is now where on <code>window</code> to look for your objects. Perhaps you add a line in init.js for <code>window.ADMIN = {}</code> and then load objects from there with <code>load_javascript_class :admin, "SomePage"</code>. This pattern should be flexible from there.</p>

<p>This pattern has solved most my issues for the past few years. I am sure there is a different pattern to use for projects with turbolinks, but I will continue to bring this pattern into all other projects because of the utility it provides.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-08-15T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tech/'>tech</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/08/15/javascript-frameworks/" itemprop="url">Javascript Frameworks</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Back in March, the company I work for was creating a small app and were trying to decide which javascript frame work to use. There was an email chain debating which framework to use. I finally responded, and today a coworker convinced me to post that email:</p>

<hr />

<p>Was debating if I wanted to take the bait, but I love to argue, so I couldn&rsquo;t resist.</p>

<p>I am not a fan of pushing the entire rendering process to the client. I am also no longer a fan of client side routing (hash nor push state). It isn&rsquo;t about CPU power, and browser capabilities. I&rsquo;ve used the first six frameworks in todomvc.com and a couple of the others, and the way I grade them is by their testability, maintainability, and productivity. Also to say, I am a big fan of modularization, which can be interpreted as numerous small single purpose apps.</p>

<p>My opinions on the big 4 frameworks:</p>

<h3>Backbone</h3>

<p>I love backbone. So easy to get started. So easy to do whatever I want. However, I have a hard time believing that it can be scaled to a team size without some hard core discipline, and structure.</p>

<p>Backbone models and collections are freaking awesome, out of all client side frameworks I have dealt with, dealing with data is absolutely the easiest in Backbone. However, it is quickly negated by its shitty controllers/routers/ViewModel layer (if you haven&rsquo;t heard of a ViewModel, I think you should look up the MVVM - model view view/mode pattern). Backbone intentionally leaves this to you. I&rsquo;ve browsed a lot of random open source projects on github that use backbone and everywhere I look there is a different way to organize things, and it feels chaotic. If you value the same things about code as I do, that is testability, modularity, readability, etc, you have to come up with your own scheme that hopefully fits all your needs. Backbone&rsquo;s intentional shortcomings are picked up by some frameworks that are built on top of it, like Marionnette&hellip; but man I hate frameworks on frameworks.</p>

<p>Finally the view. Not the view you know of from rails, I&rsquo;ll call that the template. The view object. I don&rsquo;t mind how they bind data or events, but ugh, the lack of templating kills me. You have to compile your own template (not a big deal, jquery and underscore provide decent templating functions), and inject that into DOM via some helper methods (Urghhh). So if you have a collection, and render a list, then behind the scenes modify a model/the collection, you have to go delete your own element and replace it in the right spot. I found it manageable until I rendered a form, and tried to modify the same view with some view changes, and it became hell.</p>

<h3>Angular</h3>

<p>My first attempts at angular were thwarted by horrific documentation, and my second attempt was painful because they were in progress of updating their horrific documentation to actually document the version they released. Oh and (at the time) an incredibly intimidating dependency injection strategy. They have matured and now the documentation isn&rsquo;t completely rubbish and the dependency injection thing actually makes sense. I am currently using angular for my side project.</p>

<p>Angular is painfully verbose. They provide a dependency injection framework that has you declaring random variables everywhere with eye blistering $ signs (I guess that is because I usually use coffeescript these days). However, I am a big fan of DI, and out of all the frameworks, I believe Angular is the only one that really tries to solve such a problem.</p>

<p>Another awesome thing about angular is it is designed to be able to be tested from the ground up. Even with the angular documentation was shit, I gave angular those attempts because they actually tested their own code with a massive test suite, and showed you how to use it, and it looked half decent. You will be surprised how many projects in the javascript community (well, any open source community really) that become popular don&rsquo;t even have a unit test suite, or a really pointless shitty one (<em>cough</em> meteor <em>cough</em>). Part of being testable is being modular, and angular skews that axis very high.</p>

<p>Angular provides no model layer&hellip; it lets you use any plain old javascript object. A freedom, but given that is was so opinionated every where else (or rather, provided structure every where else), this is a let down.</p>

<p>My last point is the way that angular binds its data. This has been an internal battle for me for quite some time; data and event binding via pseudo html attributes vs declared event observers and interpolation. They are very different styles. I wouldn&rsquo;t necessarily choose a framework because of how they bind events, but there are some tradeoffs that I have seen some highly philosophical and argumentative developers will fight over, but I&rsquo;m not going to get into that here.</p>

<h3>Ember</h3>

<p>Now that ember has successfully separated its image from sprout, I think ember is very solid. Solid models/events, solid and high profile team behind it, solid (IMHO) way to declare templates, sensible view models, not bad collections. The only thing keeping me from constantly using ember js is its tight integration with handlebars (my use case for these frameworks don&rsquo;t align with that kind of templating, I&rsquo;ll explain in a sec).</p>

<h3>Knockout</h3>

<p>Last time I tried knockout, it felt like they were cramming ajax down my throat&hellip; they seem much better about that now. It has an awkward and sometimes ridiculously verbose ways of doing things. Was built by microsoft, the inventors of MVVM&hellip; was built by microsoft so I don&rsquo;t give it a serious look.</p>

<h3>Here are some random thoughts:</h3>

<p>I&rsquo;m done with client side routing for a while, it is annoying to deal with. You have to intercept all links, and redirect it back to your own router. You have to make sure that if you fill out a form, go to another page, come back to the form that the form is emptied. If one page breaks you may have just made the user stuck without any kind of indication that they are used to. You have to basically reinvent http status codes. Github can&rsquo;t even get it right (if you hit the back button too fast while browsing code, you can end up on a page different from what is in your url bar. This happens to me all the time and annoys the crap out of me.) With pushstate you have to make sure every page works if you hit the refresh button.</p>

<p>Rendering html has been solved before, and optimized. Think about all the compression web severs do, think about how browsers do progressive loading. Think about how in our ajax world we had to reinvent so many things (spinners, status codes, etc.)</p>

<p>On my current side project I chose angular. There is only one reason I chose it over the others, and that is because of how it binds data/events. I don&rsquo;t know about you, but I love haml/jade. The way I like to work when I have a scenario where I have dynamic client views is to have the server do as much rendering as possible, and then provide a template for whatever needs to be dynamic. This means using haml/jade on the server, and then feeding that into the templating mechanism of my mvvm framework. The syntax of handlebars is not easily compatible with any whitespace based markup language. With angular I can have the server side compile jade, and leave in the data binding syntax of angular.</p>

<p>like this (jade):</p>

<pre><code>p(class=") foo  #{baz}
</code></pre>

<p>If baz was a variable set to &ldquo;qux&rdquo; on the server, that would compile to</p>

<pre><code>&lt;p class="&gt;foo  qux&lt;/p&gt;
</code></pre>

<p>and then angular would pick those  up later for templating.</p>

<p>This fits well with my two of my three favorite features in rails; forms and routes.</p>

<p>form_for is such a time saver in my opinion, and I miss rails routes every time I try something that isn&rsquo;t rails. With this scheme in a rails environment, you get to use your form_for or your *_path methods on the server, then let the client do work after. I have gotten this to work before, I don&rsquo;t remember exactly, but I believe you can trick rails into taking odd parameters into url helpers&hellip;</p>

<p>if this were my haml:</p>

<pre><code>%p= post_path("")
</code></pre>

<p>and you had post declared as a resource, you would get</p>

<pre><code>&lt;p&gt;/posts/&lt;/p&gt;
</code></pre>

<p>which can be fed into a templating engine. I think you can do the same with form_for and stuff too.</p>

<p>However, my choices are for my personal side project, where I know where everything is&hellip; have to remember that different factors come into play when you are in a team.</p>

<p>K, I&rsquo;m done rambling&hellip; I didn&rsquo;t even get into testability, but whatever.</p>

<hr />

<p>Fast forward to today. We use hamlc + Backbone.js + marionette, and jasmine. Looks like github finally fixed their back button problem. My url_for trick doesn&rsquo;t work with certain characters in certain versions of rails. I learned that angular is very ugly when trying to deal with events over sockets due to the lack of the model. Backbone is painful with relational data (especially many to many).</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-04-18T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tech/'>tech</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/04/18/presentation-on-continuous-delivery/" itemprop="url">Presentation on Continuous Delivery</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://phillc-cd.meteor.com/">This presentation</a> was built with <a href="https://github.com/phillc/meteor-impress">meteor-impress</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-03-31T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2012/03/31/im-not-really-a-focused-writer/" itemprop="url">I'm Not Really a Focused Writer</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>So follow me on <a href="http://twitter.com/phillc">twitter</a> or <a href="http://github.com/phillc">github</a> instead.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2012-01-20T00:00:00-05:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2012/01/20/decided-to-move-my-blog-to-posterous/" itemprop="url">Decided to Move My Blog to Posterous.</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Seems like I have a hard time being motivated enough to write anything down. There is definitely some overhead in writing my own blog, which is why I moved away from my custom Django blog. From there I have tried a bunch of static site generators powered by git/github (like nanoc, jekyll and webgen). I think switching to a tool that I don’t have to maintain and has features like mobile compatibility or email posting might tip me over the edge.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-06-06T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tech/'>tech</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/06/06/v8-js-ubuntu-scons-error/" itemprop="url">V8 Scons Error</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>While trying to install Google v8, I had an error:</p>

<pre><code>v8-read-only$ scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
g++ -o obj/release/api.o -c -Wall -Werror -W -Wno-unused-parameter -Wnon-virtual-dtor -pedantic -m32 -O3 -fomit-frame-pointer -fdata-sections -ffunction-sections -ansi -fno-rtti -fno-exceptions -fvisibility=hidden -Wall -Werror -W -Wno-unused-parameter -Wnon-virtual-dtor -pedantic -m32 -O3 -fomit-frame-pointer -fdata-sections -ffunction-sections -ansi -DV8_TARGET_ARCH_IA32 -DENABLE_VMSTATE_TRACKING -DENABLE_LOGGING_AND_PROFILING -DENABLE_DEBUGGER_SUPPORT -Isrc src/api.cc
cc1plus: warnings being treated as errors
src/handles-inl.h: In static member function 'static void v8::V8::RemoveMessageListeners(void (*)(v8::Handle&lt;v8::Message&gt;, v8::Handle&lt;v8::Value&gt;))':
src/handles-inl.h:50: error: dereferencing pointer '&lt;anonymous&gt;' does break strict-aliasing rules
src/handles-inl.h:50: error: dereferencing pointer '&lt;anonymous&gt;' does break strict-aliasing rules
src/utils.h:739: note: initialized from here
cc1plus: error: dereferencing pointer 'dest' does break strict-aliasing rules
cc1plus: error: dereferencing pointer 'dest' does break strict-aliasing rules
cc1plus: error: dereferencing pointer 'dest' does break strict-aliasing rules
cc1plus: error: dereferencing pointer 'dest' does break strict-aliasing rules
src/api.cc:3767: note: initialized from here
scons: *** [obj/release/api.o] Error 1
scons: building terminated because of error
</code></pre>

<p>Solved by using export GCC_VERSION=44, before running scons.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2009-10-14T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tech/'>tech</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2009/10/14/javascript-state-machine/" itemprop="url">Javascript State Machine</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://github.com/phillc/Javascript-State-Machine">I wrote a simple Javascript State Machine.</a></p>

<p>It is intended for keeping track of what the current state is for my heavy AJAX app at work.</p>

<p>I also learned a lot about OO in javascript without using jQuery or the prototype framework, by using prototypes. I wanted to do that so that it would be framework independent.</p>

<p>Below is a simple example of how I use the state machine, and shows a bit of how I connected it with <a href="http://code.google.com/p/reallysimplehistory/">Really Simple History</a></p>

<p>I have included in this example some comments to show my thinking throughout, and perhaps how to use it.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Site</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StateMachine</span><span class="p">();</span>
<span class="nx">Site</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">states</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Begin</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">enter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">// do some animation</span>
        <span class="p">},</span>
        <span class="nx">exit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">// hide some stuff</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">Page</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">enter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">// show some page</span>
        <span class="p">},</span>
        <span class="nx">exit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">// hide it</span>
        <span class="p">},</span>
        <span class="nx">change</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
            <span class="c1">// example of some event</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">change_page</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
            <span class="c1">// events can call events</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">handleEvent</span><span class="p">(</span><span class="s1">&#39;setURL&#39;</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">setURL</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="c1">//example of how I integrate with really simple history</span>
            <span class="nx">dhtmlHistory</span><span class="p">.</span><span class="nx">add</span><span class="p">([</span><span class="s1">&#39;pages&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">current_page</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// These are some call backs I used for debugging with firebug to ensure</span>
<span class="c1">// that events were firing</span>
<span class="nx">Site</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">beforeEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;begin event: &#39;</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">Site</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">afterEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;end event: &#39;</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">Site</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">beforeStateChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">from</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;begin state change to: &#39;</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="s1">&#39; from: &#39;</span><span class="p">,</span> <span class="nx">from</span><span class="p">);</span>

    <span class="c1">// as an example of intercepting, I can stop a state from changing by returning false</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">to</span> <span class="o">==</span> <span class="s1">&#39;Page&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">blocker</span> <span class="o">==</span> <span class="s1">&#39;Page&#39;</span><span class="p">){</span>
        <span class="c1">// some logic</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">Site</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">afterStateChange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">from</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;end state change to: &#39;</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="s1">&#39; from: &#39;</span><span class="p">,</span> <span class="nx">from</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// The actual defenition. Instance vars can be set in it.</span>
<span class="kd">function</span> <span class="nx">Site</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pages</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Page</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// global scope, so that it can be accessed globally (as it wouldn&#39;t normally</span>
<span class="c1">// be because the scope that I actually instantiate it inside prorotype&#39;s window onload)</span>
<span class="kd">var</span> <span class="nx">Davis</span><span class="p">;</span> 


<span class="c1">// Once again, just an example of how I integrate it with Really Simple History</span>
<span class="kd">function</span> <span class="nx">historyChange</span><span class="p">(</span><span class="nx">newLocation</span><span class="p">,</span> <span class="nx">historyData</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">newLocation</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">newState</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">shift</span><span class="p">().</span><span class="nx">capitalize</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">newState</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="nx">newState</span> <span class="o">=</span> <span class="s1">&#39;Begin&#39;</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Davis</span><span class="p">.</span><span class="nx">changeState</span><span class="p">(</span><span class="nx">newState</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">hash</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">Davis</span><span class="p">.</span><span class="nx">handleEvent</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This window observe for onload is prototype specific... But you can achieve the same other ways.</span>
<span class="nx">Event</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Davis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Site</span><span class="p">();</span> <span class="c1">// my requirements need me to initialize after load</span>

    <span class="c1">// Really Simple History stuff</span>
    <span class="nx">dhtmlHistory</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="nx">historyChange</span><span class="p">);</span>
    <span class="nx">historyChange</span><span class="p">(</span><span class="nx">dhtmlHistory</span><span class="p">.</span><span class="nx">currentLocation</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>


<p>While implementing this, I also learned a bit about bookmarking and enabling the back button of ajax states. Really Simple History has worked ok for me, but it has some quirks&hellip; some of which I haven&rsquo;t solved yet (especially in IE) and those bugs may be above.</p>

<p>I also got my first dose of unit testing in javascript&hellip; and found some really cool library to assist in the development called <a href="http://newjs.rubyforge.org/">newjs</a> . However, at the time of this writing, the unit tests are not up to the current code, as a lot has changed&hellip; I will deal with that later.</p>

<p>Anyway, while my implementation surely isn&rsquo;t the best in the world, I hope someone can find use from it.</p>

<p><a href="http://github.com/phillc/Javascript-State-Machine">http://github.com/phillc/Javascript-State-Machine</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2009-08-28T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tech/'>tech</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2009/08/28/ruby-multi-dimensional-array-helper/" itemprop="url">Ruby Multi-dimensional Array Helper</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I needed something to help me get through a multi-dimensional array. So I extended the Array class.</p>

<p>Grab expects an array of coordinates.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Array</span>
  <span class="k">def</span> <span class="nf">grab</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">position</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">grab</span><span class="p">(</span><span class="n">position</span><span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span> <span class="k">unless</span> <span class="n">position</span><span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">].</span><span class="n">empty?</span>
    <span class="n">value</span>
  <span class="k">rescue</span> <span class="no">NoMethodError</span>
    <span class="k">raise</span><span class="p">(</span><span class="no">IndexError</span><span class="p">,</span> <span class="s2">&quot;Multi Dimensional Array not deep enough&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>


<p>Then I can do this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&gt;&gt;</span> <span class="o">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">,</span><span class="s2">&quot;asdf&quot;</span><span class="p">,</span><span class="o">[[</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="o">]</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="o">]].</span><span class="n">grab</span><span class="p">(</span><span class="o">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="mi">11</span>
<span class="o">&gt;&gt;</span> <span class="o">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">,</span><span class="s2">&quot;asdf&quot;</span><span class="p">,</span><span class="o">[[</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="o">]</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="o">]].</span><span class="n">grab</span><span class="p">(</span><span class="o">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">]</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="mi">33</span>
<span class="o">&gt;&gt;</span> <span class="o">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">,</span><span class="s2">&quot;asdf&quot;</span><span class="p">,</span><span class="o">[[</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="o">]</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="o">]].</span><span class="n">grab</span><span class="p">(</span><span class="o">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="mi">5</span>
<span class="o">&gt;&gt;</span> <span class="o">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">,</span><span class="s2">&quot;asdf&quot;</span><span class="p">,</span><span class="o">[[</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="o">]</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="o">]].</span><span class="n">grab</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span>
<span class="ss">IndexError</span><span class="p">:</span> <span class="no">Not</span> <span class="n">an</span> <span class="n">array</span><span class="o">.</span>
    <span class="n">from</span> <span class="sr">/Users/</span><span class="n">phillip</span><span class="o">/</span><span class="no">Desktop</span><span class="o">/</span><span class="n">rworkspace</span><span class="o">/</span><span class="n">davisbrandcapital</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">tagging</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">73</span><span class="ss">:in</span> <span class="sb">`grab&#39;</span>
<span class="sb">   from (irb):64</span>
<span class="sb">&gt;&gt; [[1,2,3],&quot;asdf&quot;,[[11,22,33],5,6,7]].grab([1])</span>
<span class="sb">=&gt; &quot;asdf&quot;</span>
<span class="sb">&gt;&gt;</span></code></pre></div>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2009-08-19T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tech/'>tech</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2009/08/19/cucumber-selenium-and-authlogic/" itemprop="url">Cucumber With Selenium and Authlogic</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I had some Issues with cucumber/selenium working properly with authlogic. After much searching, I&rsquo;ve figured out how to get it all to work properly.</p>

<p>I would get an error like:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">When I follow <span class="s2">&quot;Manage pages&quot;</span>                          <span class="c"># features/step_definitions/webrat_steps.rb:19</span>
  ed out after 5000ms <span class="o">(</span>Selenium::CommandError<span class="o">)</span>
  /opt/local/lib/ruby/1.8/timeout.rb:62:in <span class="sb">`</span>timeout<span class="s1">&#39;</span>
<span class="s1">  /opt/local/lib/ruby/1.8/timeout.rb:93:in `timeout&#39;</span>
  <span class="o">(</span><span class="nb">eval</span><span class="o">)</span>:2:in <span class="sb">`</span>/^I follow <span class="s2">&quot;([^\&quot;]*)&quot;</span><span class="nv">$/</span><span class="s1">&#39;</span>
<span class="s1">  features/plain/admin_page.feature:8:in `When I follow &quot;Manage pages&quot;&#39;</span></code></pre></div>


<p>Initially, to setup authlogic to work with regular webrat tests, I had to put the following in my env.rb:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">&quot;authlogic/test_case&quot;</span>

<span class="no">Before</span> <span class="k">do</span>
  <span class="n">activate_authlogic</span>
<span class="k">end</span></code></pre></div>


<p>After getting it working with webrat, I decided I wanted to test some of my javascript and AJAX with selenium, so I followed <a href="http://wiki.github.com/aslakhellesoy/cucumber/setting-up-selenium">this guide</a></p>

<p>The database_cleaner gem had to be added because you can&rsquo;t use</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Cucumber</span><span class="o">::</span><span class="no">Rails</span><span class="o">.</span><span class="n">use_transactional_fixtures</span></code></pre></div>


<p>with selenium, so it had to be removed from the env.rb and placed in the plain.rb. As a result, this ended up in my enhanced.rb</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;database_cleaner&#39;</span>
  <span class="no">Before</span> <span class="k">do</span>
    <span class="c1"># truncate your tables here, since you can&#39;t use transactional fixtures*</span>
    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="ss">:truncation</span>
    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">clean</span>
  <span class="k">end</span></code></pre></div>


<p>and this ended up in my plain.rb</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;database_cleaner&#39;</span>
<span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="ss">:truncation</span>
<span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">clean</span></code></pre></div>


<p>Originally, I had it just in my enhanced.rb as an After block instead of Before, but after further contemplation, I realized that if something goes terribly wrong with the selenium tests, then the database would have bad data in it&hellip; So might as well clean it before hand.</p>

<p>Finally, my problem with authlogic + seleniu, was how I wrote my test. The way it was erroring out made it look like something completely different (the selenium timeout error), but after I watched it a couple times closely, I determined that the test was being sent to the next page before the &ldquo;button press&rdquo; was executed.</p>

<p>Here is the beginning of my test that failed:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">Scenario</span><span class="p">:</span> <span class="no">Visit</span> <span class="no">Add</span> <span class="no">Page</span> <span class="n">page</span>
    <span class="no">Given</span> <span class="n">I</span> <span class="n">am</span> <span class="n">logged</span> <span class="k">in</span>
    <span class="no">And</span> <span class="n">I</span> <span class="n">am</span> <span class="n">on</span> <span class="s2">&quot;the admin page&quot;</span>
    <span class="no">When</span> <span class="n">I</span> <span class="n">follow</span> <span class="s2">&quot;Manage pages&quot;</span>
    <span class="no">And</span> <span class="n">I</span> <span class="n">follow</span> <span class="s2">&quot;New Page&quot;</span></code></pre></div>


<p>With a little help from <a href="http://stackoverflow.com/questions/966052/cucumber-selenium-fails-randomly/966998#966998">a post on stack overflow</a>, I got it to work with the following:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">user</span>
  <span class="vi">@user</span> <span class="o">||=</span> <span class="no">Factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">login</span>
  <span class="n">user</span>
  <span class="n">fill_in</span> <span class="s2">&quot;Email&quot;</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> 
  <span class="n">fill_in</span> <span class="s2">&quot;Password&quot;</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password</span>
  <span class="n">click_button</span> <span class="s2">&quot;Login&quot;</span>

  <span class="c1"># This is what was added</span>
  <span class="k">if</span> <span class="no">Webrat</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="ss">:selenium</span>
    <span class="n">selenium</span><span class="o">.</span><span class="n">wait_for_page_to_load</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Given</span> <span class="sr">/^I am logged out$/</span> <span class="k">do</span>
  <span class="vi">@current_user_session</span><span class="o">.</span><span class="n">destroy</span> <span class="k">if</span> <span class="vi">@current_user_session</span>
<span class="k">end</span>

<span class="no">Given</span> <span class="sr">/^I am logged in$/</span> <span class="k">do</span>
  <span class="n">visit</span> <span class="n">path_to</span><span class="p">(</span><span class="s2">&quot;the login page&quot;</span><span class="p">)</span>
  <span class="n">login</span>
<span class="k">end</span>

<span class="no">When</span> <span class="sr">/^I login$/</span> <span class="k">do</span>
  <span class="n">login</span>
<span class="k">end</span></code></pre></div>


<p>Notice I had to add the if selenium line in order to get it to work in webrat.</p>

<p>Something tells me there is a better way to do it&hellip; probably overriding the click_button method when selenium is loaded&hellip; but I don&rsquo;t know it well enough quite yet to venture that far, I&rsquo;ll probably try it soon though.</p>

<p>Edit: oh, its a thing with webrat&hellip; but installing the newest version didn&rsquo;t fix it for me, then I actually read the <a href="https://webrat.lighthouseapp.com/projects/10503/tickets/226-not-waiting-for-page-load-with-selenium">ticket&hellip;</a> I&rsquo;ll stick with my current solution for now.</p>

<p>Edit2: Actually the issue is in the visit method, if you can believe that. click_button works fine, as it waits for the page to load before clicking, but the visit method is sent so fast, that because of the way my test is set up, we are sent to the next page either before the login button is pressed, or before the request gets a chance to process&hellip; I don&rsquo;t feel like investigating which one it exactly is, because the solution is the same&hellip; wait for the next page to load.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2009-08-18T00:00:00-04:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/tech/'>tech</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2009/08/18/e-text-editor/" itemprop="url">e-Text Editor</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Was attempting to compile e-text editor on ubuntu 9.10 (yea yea, I know&hellip; my right to complain about broken packages disappears since its alpha) just to try it out, but had a sick number of errors ranging from &ldquo;Cannot compile wxWidgets&rdquo; to &ldquo;Cannot compile WebKit&rdquo;.</p>

<p>Finally, after trying multiple ways of compiling wxWidgets, I figured out the real error was</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="s2">&quot;./include/wx/gsocket.h:40: error: using typedef-name ‘GSocket’ after ‘class’&quot;</span></code></pre></div>


<p>So I applied a patch I found at <a href="http://trac.wxwidgets.org/ticket/10883">http://trac.wxwidgets.org/ticket/10883</a> to the wxwidgets folder. and it suddenly worked.</p>

<p>edit: I turned out that I also had to update glib. glib version 2.20 did it for me.</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/posts/2" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    Phillip Campbell


<p>Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></p>
</footer>
		</div>
	</div>
	

<script type="text/javascript">
      var disqus_shortname = 'phillc';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
