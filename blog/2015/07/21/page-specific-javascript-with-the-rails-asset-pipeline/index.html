
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Page Specific JavaScript with the Rails Asset Pipeline - phillc - Phillip Campbell</title>
	<meta name="author" content="Phillip Campbell">

	
	<meta name="description" content="Page Specific JavaScript With the Rails Asset Pipeline I&rsquo;ve been using a pattern for loading javascript for specific pages that I would like &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="" rel="alternate" title="phillc - Phillip Campbell" type="application/atom+xml">
	
	<link rel="canonical" href="http://phillc.com/blog/2015/07/21/page-specific-javascript-with-the-rails-asset-pipeline/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4379922-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><a href="/" class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/a378a027352ae0dc9c0bd249d06b46c3?s=160" alt="Profile Picture" style="width: 160px;" />
	
</a>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Home</a></li>
    <li><a href="/blog/archives">Archives</a></li>
    <li style="color: #666;">Side projects:</li>
    <li><a href="http://agentvsagent.com">Agent vs Agent</a></li>
    <li><a href="http://rosterbater.com">Rosterbater</a></li>
    <li><a href="http://www.cheapboardgamer.com">the Cheap Boardgamer</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
			<a class="facebook" href="http://www.facebook.com/phillc" title="Facebook">Facebook</a>
		
		
		
			<a class="twitter" href="http://twitter.com/phillc" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/phillc" title="GitHub">GitHub</a>
		
		
		
		
			<a class="linkedin" href="http://www.linkedin.com/in/phillc1" title="LinkedIn">LinkedIn</a>
		
		
		
		
		
		
		
    	
    	
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Page Specific JavaScript With the Rails Asset Pipeline</h1>
	<div class="entry-content" itemprop="articleBody"><p>I&rsquo;ve been using a pattern for loading javascript for specific pages that I would like to share. I have been using it for the past three years across many projects, and has proven to be durable.</p>

<p>It was created in response to three patterns that I saw and disliked.</p>

<ul>
<li>Using <code>javascript_include_tag</code> to bring in page specific javascript</li>
<li>Keying javascript off of a html element id <code>if ($("#some_div")) { ... }</code></li>
<li>Inline javascript</li>
</ul>


<p>I found all these solutions to be inadequate because they required extra web requests, didn&rsquo;t take advantage of js compression, had javascript overhead of checking the page for contents, didn&rsquo;t allow the use of coffeescript, or left javascript scattered around the project. The Rails Asset Pipeline solves all those problems.</p>

<p>My solution is to use a JavaScript object to wrap pages, which I will call Page Objects.</p>

<p>A Page Object looks like this:</p>

<figure class='code'><figcaption><span>app/assets/javascripts/app/pages/home_page.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nv">APP.HomePage = </span><span class="k">class</span> <span class="nx">HomePage</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">(options) -&gt;</span>
</span><span class='line'>    <span class="vi">@data = </span><span class="nx">options</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">bind: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">@bindThing</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">@bindOtherthing</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">bindThing: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">otherSomething</span><span class="p">(</span><span class="nx">@data</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">bindOtherthing: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">otherSomething</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Every Page Object is applied to window.APP, has a <code>bind</code> method which will run any page specific code, and lives in app/assets/javascripts/app/pages. You will see why in a moment. The constructor is optional.</p>

<p>We bring this into our asset pipeline like so:</p>

<figure class='code'><figcaption><span>app/assets/javascripts/application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="o">//=</span> <span class="nx">require</span> <span class="p">.</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">init</span>
</span><span class='line'><span class="o">//=</span> <span class="nx">require_tree</span> <span class="p">.</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">objects</span>
</span><span class='line'><span class="o">//=</span> <span class="nx">require_tree</span> <span class="p">.</span><span class="o">/</span><span class="nx">app</span><span class="o">/</span><span class="nx">pages</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our pages are assigned to <code>window.APP</code>, which needs to be initialized before the page objects are loaded. Because requiring javascript files must happen at the top of your file, before any executable javascript is written, we must move the initialization of <code>window.APP</code> to another file.</p>

<figure class='code'><figcaption><span>app/assets/javascripts/app/init.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nv">APP = </span><span class="p">{}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, we want to have rails instantiate one of these objects, and call our <code>bind</code> method for us.</p>

<figure class='code'><figcaption><span>app/helpers/application_helper.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">ApplicationHelper</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">load_javascript_class</span><span class="p">(</span><span class="n">javascript_class</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="n">content_for</span> <span class="ss">:page_javascript</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">javascript_tag</span> <span class="s2">&quot;$(function(){ (new window.APP.</span><span class="si">#{</span><span class="n">javascript_class</span><span class="si">}</span><span class="s2">(</span><span class="si">#{</span><span class="n">options</span><span class="o">.</span><span class="n">to_json</span><span class="si">}</span><span class="s2">)).bind(); })&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/views/layouts/application.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="nn">!!!5</span>
</span><span class='line'><span class="nt">%html</span><span class="p">{</span><span class="ss">lang</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nt">%body</span>
</span><span class='line'>    <span class="p">=</span> <span class="n">render</span> <span class="s1">&#39;layouts/header&#39;</span>
</span><span class='line'>    <span class="p">=</span> <span class="k">yield</span>
</span><span class='line'>    <span class="p">=</span> <span class="n">render</span> <span class="s1">&#39;layouts/footer&#39;</span>
</span><span class='line'>    <span class="p">=</span> <span class="k">yield</span> <span class="ss">:page_javascript</span>
</span></code></pre></td></tr></table></div></figure>


<p>The last part of it is to call it from your view</p>

<figure class='code'><figcaption><span>app/views/home/index.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="p">-</span> <span class="n">load_javascript_class</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span> <span class="ss">data</span><span class="p">:</span> <span class="o">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.container</span>
</span><span class='line'>  <span class="nc">.row</span>
</span><span class='line'>    <span class="nt">%h3</span> List:
</span></code></pre></td></tr></table></div></figure>


<p>With this pattern, you can have page specific javascript while utilizing the asset pipeline of rails. This solution also solves the problem of how to get data from rails to your javascript. You can see in the helper that if you pass in a second argument to <code>load_javascript_class</code> that it will take it, and turn it into json for your page object&rsquo;s constructor.</p>

<p>You may have noticed that I also have a app/objects required in the application.js. I do this to create objects that may be shared between pages. I tend to use a similar pattern as page objects, and instantiate/delegate to them from a page object.</p>

<p>Some sites need to have two sets of javascript, perhaps for very different sections of the site, like an admin area. You can change the helper to be</p>

<figure class='code'><figcaption><span>app/helpers/application_helper.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">load_javascript_class</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">javascript_class</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>  <span class="n">content_for</span> <span class="ss">:page_javascript</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">javascript_tag</span> <span class="s2">&quot;$(function(){ (new window.</span><span class="si">#{</span><span class="n">namespace</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">upcase</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">javascript_class</span><span class="si">}</span><span class="s2">(</span><span class="si">#{</span><span class="n">options</span><span class="o">.</span><span class="n">to_json</span><span class="si">}</span><span class="s2">)).bind(); })&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first parameter is now where on <code>window</code> to look for your objects. Perhaps you add a line in init.js for <code>window.ADMIN = {}</code> and then load objects from there with <code>load_javascript_class :admin, "SomePage"</code>. This pattern should be flexible from there.</p>

<p>This pattern has solved most my issues for the past few years. I am sure there is a different pattern to use for projects with turbolinks, but I will continue to bring this pattern into all other projects because of the utility it provides.</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    Phillip Campbell


<p>Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></p>
</footer>
		</div>
	</div>
	

<script type="text/javascript">
      var disqus_shortname = 'phillc';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://phillc.com/blog/2015/07/21/page-specific-javascript-with-the-rails-asset-pipeline/';
        var disqus_url = 'http://phillc.com/blog/2015/07/21/page-specific-javascript-with-the-rails-asset-pipeline/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
